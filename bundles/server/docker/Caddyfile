# Caddyfile for Explorama Server Bundle
# Handles reverse proxy to backend and serves static frontend files

{
    # Global options
    auto_https off
    admin off
}

# Main server block
:80 {
    # Enable compression
    encode gzip

    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # API endpoints - proxy to Explorama backend
    handle /api/* {
        reverse_proxy localhost:4001
    }

    # WebSocket endpoint - proxy to Explorama backend
    handle /ws {
        reverse_proxy localhost:4001
    }

    # Authentication endpoints - proxy to Tinyauth
    handle /auth/* {
        reverse_proxy localhost:8080
    }

    # Static files - serve from public directory
    handle {
        root * /app/public
        try_files {path} /index.html
        file_server
    }

    # Logging
    log {
        output stdout
        format console
    }
}
