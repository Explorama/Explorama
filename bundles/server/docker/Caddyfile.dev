# Caddyfile for Explorama Development
# Proxies to services running on the host machine via socat tunnels

{
    # Global options
    auto_https off
    admin off
}

# Main server block
:80 {
    # Enable compression
    encode gzip

    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # Figwheel WebSocket - proxy to host Figwheel on port 8020
    handle /figwheel-ws/* {
        reverse_proxy localhost:8020
    }

    # API endpoints - proxy to host backend on port 4001
    handle /api/* {
        reverse_proxy localhost:4001
    }

    # WebSocket endpoint - proxy to host backend on port 4001
    handle /ws {
        reverse_proxy localhost:4001
    }

    # Authentication endpoints - proxy to Tinyauth (in container)
    handle /auth/* {
        reverse_proxy localhost:8080
    }

    # Static files - proxy to host Figwheel server on port 8020
    # In development, Figwheel serves the static files
    handle {
        reverse_proxy localhost:8020
    }

    # Logging
    log {
        output stdout
        format console
    }
}
